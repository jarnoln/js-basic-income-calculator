<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="utf-8">
<title> Perustulolaskuri </title>
</head>

<body>
<h1> Perustulolaskuri </h1>

<form id="basic_income_form" action="#">
  <fieldset>
     <label for="basic_income_amount">Perustulo</label>
     <input id="basic_income_amount" type="text">
     <label for="margin_pct">Veroprosentti</label>
     <input id="margin_pct" type="text">
     <input type="submit" value="Laske">
   </fieldset>
</form>

<table id="basic_income_table" style="text-align: right">
<tr> <th> Tulot </th> <th> Tililtä </th> <th> Tilille </th> <th> Valtiolle </th> <th> Käteen </th> <th> Kokonaisvero-% </th> </tr>
</table>

<script>

function calculate_basic_income_table(basic_income, margin, mandatory_save_pct) {
  var table = document.getElementById("basic_income_table");

  for (var income=0; income<=10000; income+=500) {
    var transfer = basic_income - (margin * income) / 100;
    console.log('transfer:', transfer);
    var account_transfer = transfer;
    var to_government = 0;
    var to_account = 0;
    var from_account = transfer;
    if (transfer < 0) {
      account_transfer = mandatory_save_pct * transfer / 100;
      to_government = transfer - account_transfer;
      to_account = -account_transfer;
      from_account = 0;
    }
    gross = income + transfer;
    if (income > 0) {
      gross_tax = (income - gross) * 100 / income;
    } else {
      gross_tax = 0
    }
    var line = "<td>" + income + "</td>";
    line +=  "<td>" + from_account + "</td>";
    line +=  "<td>" + to_account + "</td>";
    line +=  "<td>" + to_government + "</td>";
    line +=  "<td>" + gross + "</td>";
    if (income === 0) {
      line += "<td> - </td>";
    } else {
      line +=  "<td>" + parseFloat(gross_tax).toFixed(1) + "% </td>";
    }
    var rowElement = document.createElement('tr');
    rowElement.innerHTML = line;
    // row.innerHTML = "Tadaa!"
    table.appendChild(rowElement);
  }
}

function init() {
    var basic_income = 750;         // Amount given by government for everyone
    var margin = 50;                // Margin deducted from income
    var mandatory_save_pct = 50;    // Which part of the deduction goes to own account, rest goes to government.
    calculate_basic_income_table(basic_income, margin, mandatory_save_pct);
}

addEventListener('load', init);

</script>
</p>

